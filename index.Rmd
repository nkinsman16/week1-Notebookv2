---
title: An R Markdown document converted from "hw1 (1).ipynb"
output: html_document
---

## **Practice**

```{r}
#Practice
x=2+3
y=6-3
x+y
```

```{r}
#Nerw Line of Code
library(ggplot2)
```

```{r}
library(rio)
```

```{r}
install.packages('rio')
```

```{r}
library(rio)
```

# Start Fresh

code for starting fresh?


```{r}
rm(list = ls())
```

```{r}
library(rio)

# Replace 'YOUR_EXCEL_FILE_URL' with the actual URL of your Excel file
excel_url <- 'YOUR_EXCEL_FILE_URL'

# Using tryCatch for error handling when reading from URL
fragility23 <- tryCatch({
  import(excel_url)
}, error = function(e) {
  message(paste("Error loading Excel file from URL:", e$message))
  message("Please ensure the URL is correct and the file is accessible.")
  return(NULL) # Return NULL on error
})

if (!is.null(fragility23)) {
  print(paste0("Successfully loaded Excel file from ", excel_url, " into data frame 'fragility23'."))
  print("First 5 rows of 'fragility23':")
  print(head(fragility23))
}
```

#get the data


code for opening a file from a url(file in Excel), name it 'fragility23'

```{r}
# opening a file from a url (file in Excel), name it 'fragility23'
linkGit="https://github.com/nkinsman16/week1-Notebookv2/raw/refs/heads/main/FSI-2023-DOWNLOAD.xlsx"
fragility23=rio::import(file = linkGit) #object that will hold the result
```

```{r}
fragility23
```

#exploratory commands


find out column names in 'fragility23'?

```{r}
#Finding out the column names
names(fragility23)
```

Check the data types in df?

```{r}
#Check the data types
str(fragility23)
```

```{r}
#Check the class types
sapply(fragility23, class)
```

```{r}
#Check the which columns are numeric
sapply(fragility23, is.numeric)
```

show me the first 10 rows?

```{r}
#Show the first 10 rows
head(fragility23, 10)
```

show me the last 10 rows?  

```{r}
#Show the last 10 rows
tail(fragility23, 10)
```

```{r}
#Summary of the numeric columns
summary(fragility23)
```

# Transformative commands

## subsetting

keep some columns: Country, Total, S1: Demographic Pressures, P1: State Legitimacy, E2: Economic Inequality into Object 'frag23_sub'

```{r}
grep(pattern = "Country|S1|P1|E2|Total",x = names(fragility23),fixed = F,value = T) # test

keep=grep("Country|S1|P1|E2|Total",names(fragility23),fixed = F,value = T)
frag23_sub=fragility23[,keep]
```

```{r}
#Creating a subsegment from the data
frag23_sub <- fragility23[, c(
  "Country",
  "Total",
  "S1: Demographic Pressures",
  "P1: State Legitimacy",
  "E2: Economic Inequality"
)]
```

##  renaming

```{r}
#Renaming the columns
colnames(frag23_sub) <- c(
  "Country",
  "Total",
  "S1",
  "P1",
  "E2"
)
```

```{r}
colnames(frag23_sub)
```

```{r}
frag23_sub
```

## filtering

get me the top ten best countries on the 'E2' measure from 'frag23_sub'

```{r}
#Sort the top countries
top10_best_E2 <- frag23_sub[order(frag23_sub$E2), ][1:10, ]
```

```{r}
top10_best_E2
```

```{r}
summary(object=top10_best_E2)
```

```{r}
tail(frag23_sub[order(x=-frag23_sub$E2),'Country'],10) #option2

```

## some computations

give the statistical description of "frag23_sub"

```{r}
summary(object = frag23_sub)
```

the value of the worst quartile in Total

```{r}
# Compute 75th percentile of Total
total_q75 <- quantile(fragility23$Total, probs = 0.75, na.rm = TRUE)

# Create indicator variable
fragility23$worst_quartile <- fragility23$Total >= total_q75
```

```{r}
table(fragility23$worst_quartile)
```

```{r}
#Identify the worst quartile Threshold
worst_quartile_countries <- fragility23$Country[
  fragility23$Total >= total_q75
]
```

```{r}
#Create the list and order it byh worst country
worst_quartile_countries <- sort(unique(worst_quartile_countries))

worst_quartile_countries
```

show correlations between "S1","E2","P1"

```{r}
## show correlations between "S1","E2", "P1"
cor(x=frag23_sub[,-c(1,2)]) #no 'Country', no "Total'
```

regress P1 and E2 on S1

```{r}
## regress P1 and E2 on S1
lm(S1~P1+E2,data=frag23_sub)
model <- lm(S1 ~ P1 + E2, data = frag23_sub)
summary(model)
```

# some plotting

give me a plot for the 'P1' variable

```{r}

# some plotting
## give me a plot for the 'P1' variable
hist(x = frag23_sub$P1) #base r
```

visual correlation between S1 and E2

```{r}
## visual correlation between S1 and E2
plot(x=frag23_sub$S1, y=frag23_sub$E2)
```

visual of the regression P1 and E2 on S1

```{r}
## the value of the worst quartile of Total
q3_Total=quantile(x = frag23_sub$Total,
                  probs = 0.75,
                  na.rm = TRUE)
## color points if country is on the worst quartile of Total
frag23_sub$Total>=q3_Total
frag23_sub$worstQt=frag23_sub$Total>=q3_Total
plot(frag23_sub$S1,
     frag23_sub$E2,pch=20,
     col = as.factor(frag23_sub$worstQt))
```

```{r}
# Select variables
vars <- fragility23[, c(
  "S1: Demographic Pressures",
  "E2: Economic Inequality",
  "P1: State Legitimacy"
)]

# Scatterplot matrix
pairs(
  vars,
  main = "Correlations between S1, E2, and P1",
  panel = function(x, y) {
    points(x, y)
    abline(lm(y ~ x), col = "blue", lwd = 2)
  }
)
```

```{r}
# Correlation matrix. "cor" computes pairwise Pearson correlations by default.
cor_matrix <- cor(vars)

# P-value matrix. Creates a 3 by 3 matrix filled with NA, sets rows and column names to match with the vars variable
p_matrix <- matrix(NA, ncol = 3, nrow = 3)
colnames(p_matrix) <- rownames(p_matrix) <- colnames(vars)
#Creates loops and computes every pairwise correlation test, performs a hypothesis test, uses Pearson correlation by default
for (i in 1:3) {
  for (j in 1:3) {
    p_matrix[i, j] <- cor.test(vars[, i], vars[, j])$p.value
  }
}
#effective sizes (strength and direction)
cor_matrix
#statistical significance
p_matrix
```

```{r}
# S1 and E2
cor.test(fragility23$`S1: Demographic Pressures`,
         fragility23$`E2: Economic Inequality`)

# S1 and P1
cor.test(fragility23$`S1: Demographic Pressures`,
         fragility23$`P1: State Legitimacy`)

# E2 and P1
cor.test(fragility23$`E2: Economic Inequality`,
         fragility23$`P1: State Legitimacy`)
```

```{r}
#Regression Models:
#lm means Linear Model, estimates the regression
#`P1: State Legitimacy` ~ `S1: Demographic Pressures` using formula syntax, one side state legitamcy (Outcome variable), Demographic pressures (predictor)
#State legitimacy as a function of Demographic pressures. Fragility23 data located within Data.
model_P1 <- lm(`P1: State Legitimacy` ~ `S1: Demographic Pressures`,
               data = fragility23)
#Follows the same expcept it looks at Economic Inequality as a function of Demographic pressures
model_E2 <- lm(`E2: Economic Inequality` ~ `S1: Demographic Pressures`,
               data = fragility23)
```

```{r}
summary(model_P1)
summary(model_E2)
```

```{r}
#Grabs Grammer of Graphes
library(ggplot2)

# P1 on S1, aes() defines the aesthetic mappings, goes back to our first Regression Models
ggplot(fragility23,
       aes(x = `S1: Demographic Pressures`,
           y = `P1: State Legitimacy`,color=worst_quartile)) +
#Adds a scatterplot and a regression line. lm (linear regression), se=TRUE (adds a shaded confidence interval around the line (95%))
geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
#Label the Plot
labs(
    title = "Regression of P1 on S1",
    x = "S1: Demographic Pressures",
    y = "P1: State Legitimacy"
  )
```

```{r}
# E2 on S1, Seeing the impact economic inequality has on Demographic pressures. Same Formula
ggplot(fragility23,
       aes(x = `S1: Demographic Pressures`,
           y = `E2: Economic Inequality`,color=worst_quartile)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    title = "Regression of E2 on S1",
    x = "S1: Demographic Pressures",
    y = "E2: Economic Inequality"
  )
```

```{r}
## visual correlation between S1 and E2
plot(x=frag23_sub$S1, y=frag23_sub$E2)

## color points if country is on the worst quartile of Total
frag23_sub$Total>=q3_Total
frag23_sub$worstQt=frag23_sub$Total>=q3_Total

plot(frag23_sub$S1,
     frag23_sub$E2,pch=20,
     col = as.factor(frag23_sub$worstQt))


# visual of the regression P1 and E2 on S1

#install.packages("sjPlot")
library(sjPlot)
plot_models(model)
```

